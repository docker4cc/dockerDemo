# 自己动手写Docker系列 -- 5.7实现通过容器制作镜像
***

## 简介
在上篇中我们实现了rm命令，删除存在的容器，本篇中，将完善之前的文件系统隔离，实现容器与容器之间的文件系统隔离

## 源码说明
同时放到了Gitee和Github上，都可进行获取

- [Gitee: https://gitee.com/free-love/docker-demo](https://gitee.com/free-love/docker-demo)
- [GitHub: https://github.com/lw1243925457/dockerDemo](https://github.com/lw1243925457/dockerDemo)

本章节对应的版本标签是：5.7，防止后面代码过多，不好查看，可切换到标签版本进行查看

## 代码实现
实现该功能的主要思路如下：

在以前的文章：[自己动手写Docker系列 -- 4.2使用AUFS包装busybox](https://juejin.cn/post/7082873999872491527)

实现了容器文件系统与宿主机文件的隔离，但目前为止，所有的容器都是使用的同一个目录，容器与容器之间存在相互影响

本篇文章目的就是为了消除这边影响，实现容器与容器之间的文件系统也进行隔离

实现思路：

以前的文件系统如下：

- 只读层：busybox系统，这个只能读，是系统的基础
- 可写层：writerLayer，这个是容器内部的可写层，能进行对应的修改
- 挂载层：mnt，挂载外部的文件系统，类似于虚拟机的文件共享

要实现容器间的文件系统隔离，就是在可写层和挂载层再加一层，以容器名称进行隔离，也就是：

- 只读层：不变
- 可写层：再加容器名为名的目录，进行隔离，也就是 writeLayer/{容器名称}
- 挂载层：再加容器名为名的目录，进行隔离，也就是 mnt/{容器名称}

文件系统进行隔离后，我们commit的时候，对应的对容器可写层进程打包即可

根据思路，代码实现也比较简单，自己理清思路后，很快便能进行改造实现

### 修改容器启动时可写层和挂载层，以容器名进行隔离

### 修改commit命令，打包容器对应目录

## 测试运行
